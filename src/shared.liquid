<!-- import Highcharts + Chartkick libraries -->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartkick@5.0.1/dist/chartkick.min.js"></script>

<!-- Calculate totals from real data dynamically -->
{% assign total_pageviews = 0 %}
{% assign total_visitors = 0 %}
{% assign total_time = 0 %}
{% assign total_visits = 0 %}

<!-- Loop through all dates in IDX_1 to calculate totals -->
{% for item in IDX_1 %}
  {% if item[1] != empty and item[1].nb_actions %}
    {% assign total_pageviews = total_pageviews | plus: item[1].nb_actions %}
    {% assign total_visitors = total_visitors | plus: item[1].nb_uniq_visitors %}
    {% assign total_time = total_time | plus: item[1].avg_time_on_site %}
    {% assign total_visits = total_visits | plus: item[1].nb_visits %}
  {% endif %}
{% endfor %}

{% assign avg_time_seconds = 0 %}
{% assign time_display = "0s" %}
{% if total_visits > 0 %}
  {% assign avg_time_seconds = total_time | divided_by: total_visits %}
  {% assign minutes = avg_time_seconds | divided_by: 60 | floor %}
  {% assign seconds = avg_time_seconds | modulo: 60 | floor %}
  
  {% if minutes > 0 %}
    {% if seconds > 0 %}
      {% assign time_display = minutes | append: "m " | append: seconds | append: "s" %}
    {% else %}
      {% assign time_display = minutes | append: "m" %}
    {% endif %}
  {% else %}
    {% assign time_display = seconds | append: "s" %}
  {% endif %}
{% endif %}
